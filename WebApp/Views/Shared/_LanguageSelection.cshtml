@using Microsoft.Extensions.Options
@using System.Globalization
@inject IOptions<RequestLocalizationOptions> LocOptions

@{
    var options = LocOptions.Value;
    var cultures = options.SupportedUICultures ?? new List<CultureInfo>();
    var current = CultureInfo.CurrentUICulture;
    var returnUrl = Context.Request.Path + Context.Request.QueryString;

    string ShortLabel(CultureInfo c)
    {
        // Nice short label like EN / ET / RU
        var two = (c.TwoLetterISOLanguageName ?? c.Name).ToUpperInvariant();
        return two.Length > 2 ? two[..2] : two;
    }
}

<div class="topbar-control dropdown">
    <button class="btn topbar-btn dropdown-toggle"
            type="button"
            id="langDropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false">
        <i class="bi bi-translate me-2"></i>
        <span class="d-none d-lg-inline">@current.NativeName</span>
        <span class="d-inline d-lg-none">@ShortLabel(current)</span>
    </button>

    <ul class="dropdown-menu dropdown-menu-end topbar-menu" aria-labelledby="langDropdown">
        <li class="dropdown-header">Language</li>

        @foreach (var c in cultures)
        {
            var isActive = current.Name.Equals(c.Name, StringComparison.OrdinalIgnoreCase);

            <li>
                <form method="post" asp-controller="Localization" asp-action="SetLanguage" class="m-0">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="culture" value="@c.Name" />
                    <input type="hidden" name="returnUrl" value="@returnUrl" />

                    <button type="submit"
                            class="dropdown-item d-flex align-items-center justify-content-between @(isActive ? "active" : "")">
                        <span class="text-truncate">@c.NativeName</span>
                        @if (isActive)
                        {
                            <i class="bi bi-check2 ms-3"></i>
                        }
                    </button>
                </form>
            </li>
        }
    </ul>
</div>