@using App.Domain.Enum
@{
    // Active link helper (Bootstrap "active" class)
    string Active(string controller, string action)
    {
        var c = (ViewContext.RouteData.Values["controller"]?.ToString()) ?? "";
        var a = (ViewContext.RouteData.Values["action"]?.ToString()) ?? "";
        return (c.Equals(controller, StringComparison.OrdinalIgnoreCase) &&
                (action == null || a.Equals(action, StringComparison.OrdinalIgnoreCase)))
            ? "active"
            : "";
    }

    bool isAdmin = User.IsInRole(RoleType.Admin.ToString()) || User.IsInRole("Admin");
    bool isReviewer = User.IsInRole(RoleType.Reviewer.ToString());
    bool isTranslator = User.IsInRole(RoleType.Translator.ToString());
}

<aside class="app-sidebar sticky-top" style="top:56px; height: calc(100vh - 56px);" aria-label="Sidebar navigation">
    <!-- Brand -->
    <a asp-controller="Home" asp-action="Index" class="brand">
        <span class="brand-icon" aria-hidden="true">
            <i class="bi bi-bag"></i>
        </span>
        <div class="brand-text">
            <div class="brand-title">@((await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Home))))</div>
            <div class="brand-subtitle text-muted">Control panel</div>
        </div>
    </a>

    <div class="sidebar-divider"></div>

    <!-- Main -->
    <nav class="nav flex-column">
        <a class="nav-link @Active("Home","Index")"
           asp-controller="Home" asp-action="Index"
           aria-current="@(Active("Home","Index") == "active" ? "page" : null)">
            <i class="bi bi-house-door"></i>
            <span>@(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Home)))</span>
        </a>

        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">
            <i class="bi bi-speedometer2"></i>
            <span>@(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Dashboard)))</span>
            <span class="ms-auto badge rounded-pill text-bg-secondary">Soon</span>
        </a>

        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">
            <i class="bi bi-table"></i>
            <span>@(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Order)))</span>
            <span class="ms-auto badge rounded-pill text-bg-secondary">Soon</span>
        </a>

        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">
            <i class="bi bi-grid"></i>
            <span>@(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Product)))</span>
            <span class="ms-auto badge rounded-pill text-bg-secondary">Soon</span>
        </a>
    </nav>

    <div class="sidebar-divider"></div>

    <!-- Categories -->
    <div class="sidebar-section">
        <div class="sidebar-section-title">
            @(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Heading_Categories)))
        </div>

        <nav class="nav flex-column">
            <a class="nav-link" asp-route-slug="monitors">
                <i class="bi bi-display"></i>
                <span>@(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Category_Monitor)))</span>
            </a>
            <a class="nav-link" asp-route-slug="laptops">
                <i class="bi bi-laptop"></i>
                <span>@(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Category_Laptop)))</span>
            </a>
            <a class="nav-link" asp-route-slug="keyboards">
                <i class="bi bi-keyboard"></i>
                <span>@(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Category_Keyboard)))</span>
            </a>
            <a class="nav-link" asp-route-slug="mice">
                <i class="bi bi-mouse"></i>
                <span>@(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Category_Mouse)))</span>
            </a>
            <a class="nav-link" asp-route-slug="audio">
                <i class="bi bi-headphones"></i>
                <span>@(await Translation.GetAsync(nameof(App.Data.Resources.Resources.Navigation_Category_Headphones)))</span>
            </a>
        </nav>
    </div>

    <!-- Role-specific -->
    @if (isAdmin || isReviewer || isTranslator)
    {
        <div class="sidebar-divider"></div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">
                @(isAdmin ? "Admin" : isReviewer ? "Reviewer" : "Translator")
            </div>

            <nav class="nav flex-column">
                @if (isAdmin)
                {
                    <a class="nav-link @Active("AdminTranslations","Index")" asp-controller="AdminTranslations" asp-action="Index">
                        <i class="bi bi-gear"></i>
                        <span>Manage translations</span>
                    </a>
                }
                @if (isReviewer)
                {
                    <a class="nav-link @Active("Reviewer","Index")" asp-controller="Reviewer" asp-action="Index">
                        <i class="bi bi-inboxes"></i>
                        <span>Review queue</span>
                    </a>
                }
                @if (isTranslator)
                {
                    <a class="nav-link @Active("LanguageSelection","MyLanguages")" asp-controller="LanguageSelection" asp-action="MyLanguages">
                        <i class="bi bi-translate"></i>
                        <span>Language selection</span>
                    </a>
                    <a class="nav-link @Active("Translations","Index")" asp-controller="Translations" asp-action="Index">
                        <i class="bi bi-chat-left-text"></i>
                        <span>Translations</span>
                    </a>
                }
            </nav>
        </div>
    }

    <!-- Bottom user panel -->
    <div class="sidebar-bottom mt-auto">
        <div class="user-card">
            <div class="user-avatar" aria-hidden="true">
                <i class="bi bi-person"></i>
            </div>

            <div class="user-meta">
                <div class="user-name">
                    @(User.Identity?.IsAuthenticated == true ? (User.Identity?.Name ?? "Signed in") : "Guest")
                </div>
                <div class="user-sub text-muted small">
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <span class="me-2">Authenticated</span>
                        @* Optional tiny debug chips (remove later) *@
                        @if (isAdmin) { <span class="badge text-bg-primary">Admin</span> }
                        else if (isReviewer) { <span class="badge text-bg-primary">Reviewer</span> }
                        else if (isTranslator) { <span class="badge text-bg-primary">Translator</span> }
                        else { <span class="badge text-bg-secondary">No role</span> }
                    }
                    else
                    {
                        <span>Not signed in</span>
                    }
                </div>
            </div>
        </div>

        <div class="d-grid gap-2 mt-2">
            @if (User.Identity?.IsAuthenticated == true)
            {
                <form asp-controller="Account" asp-action="Logout" method="post">
                    <button class="btn btn-outline-light btn-sm w-100" type="submit">
                        <i class="bi bi-box-arrow-right me-2"></i> Sign out
                    </button>
                </form>
            }
            else
            {
                <a class="btn btn-outline-light btn-sm w-100" asp-controller="Account" asp-action="Login">
                    <i class="bi bi-box-arrow-in-right me-2"></i> Sign in
                </a>
            }
        </div>
    </div>
</aside>
